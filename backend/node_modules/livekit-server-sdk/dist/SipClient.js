import { SIPTrunkInfo, CreateSIPTrunkRequest, ListSIPTrunkRequest, ListSIPTrunkResponse, DeleteSIPTrunkRequest, SIPDispatchRule, SIPDispatchRuleInfo, CreateSIPDispatchRuleRequest, ListSIPDispatchRuleRequest, ListSIPDispatchRuleResponse, DeleteSIPDispatchRuleRequest, SIPParticipantInfo, SIPDispatchRuleDirect, SIPDispatchRuleIndividual, CreateSIPParticipantRequest, } from '@livekit/protocol';
import ServiceBase from './ServiceBase.js';
import { livekitPackage, TwirpRpc } from './TwirpRPC.js';
const svc = 'SIP';
/**
 * Client to access Egress APIs
 */
export class SipClient extends ServiceBase {
    /**
     * @param host hostname including protocol. i.e. 'https://cluster.livekit.io'
     * @param apiKey API Key, can be set in env var LIVEKIT_API_KEY
     * @param secret API Secret, can be set in env var LIVEKIT_API_SECRET
     */
    constructor(host, apiKey, secret) {
        super(apiKey, secret);
        this.rpc = new TwirpRpc(host, livekitPackage);
    }
    /**
     * @param number phone number of the trunk
     * @param opts CreateSipTrunkOptions
     */
    async createSipTrunk(number, opts) {
        let inboundAddresses;
        let inboundNumbers;
        let inboundUsername = '';
        let inboundPassword = '';
        let outboundAddress = '';
        let outboundUsername = '';
        let outboundPassword = '';
        if (opts !== undefined) {
            inboundAddresses = opts.inbound_addresses;
            inboundNumbers = opts.inbound_numbers;
            inboundUsername = opts.inbound_username || '';
            inboundPassword = opts.inbound_password || '';
            outboundAddress = opts.outbound_address || '';
            outboundUsername = opts.outbound_username || '';
            outboundPassword = opts.outbound_password || '';
        }
        const req = new CreateSIPTrunkRequest({
            inboundAddresses: inboundAddresses,
            inboundNumbers: inboundNumbers,
            inboundUsername: inboundUsername,
            inboundPassword: inboundPassword,
            outboundNumber: number,
            outboundAddress: outboundAddress,
            outboundUsername: outboundUsername,
            outboundPassword: outboundPassword,
        }).toJson();
        const data = await this.rpc.request(svc, 'CreateSIPTrunk', req, await this.authHeader({}));
        return SIPTrunkInfo.fromJson(data, { ignoreUnknownFields: true });
    }
    async listSipTrunk() {
        var _a;
        let req = {};
        const data = await this.rpc.request(svc, 'ListSIPTrunk', new ListSIPTrunkRequest(req).toJson(), await this.authHeader({}));
        return (_a = ListSIPTrunkResponse.fromJson(data, { ignoreUnknownFields: true }).items) !== null && _a !== void 0 ? _a : [];
    }
    /**
     * @param sipTrunkId sip trunk to delete
     */
    async deleteSipTrunk(sipTrunkId) {
        const data = await this.rpc.request(svc, 'DeleteSIPTrunk', new DeleteSIPTrunkRequest({ sipTrunkId }).toJson(), await this.authHeader({}));
        return SIPTrunkInfo.fromJson(data, { ignoreUnknownFields: true });
    }
    /**
     * @param rule sip dispatch rule
     * @param opts CreateSipDispatchRuleOptions
     */
    async createSipDispatchRule(rule, opts) {
        let trunkIds;
        let hidePhoneNumber = false;
        let ruleProto = undefined;
        if (opts !== undefined) {
            trunkIds = opts.trunkIds;
            hidePhoneNumber = opts.hidePhoneNumber || false;
        }
        if (rule.type == 'direct') {
            ruleProto = new SIPDispatchRule({
                rule: {
                    case: 'dispatchRuleDirect',
                    value: new SIPDispatchRuleDirect({
                        roomName: rule.roomName,
                        pin: rule.pin || '',
                    }),
                },
            });
        }
        else if (rule.type == 'individual') {
            ruleProto = new SIPDispatchRule({
                rule: {
                    case: 'dispatchRuleIndividual',
                    value: new SIPDispatchRuleIndividual({
                        roomPrefix: rule.roomPrefix,
                        pin: rule.pin || '',
                    }),
                },
            });
        }
        const req = new CreateSIPDispatchRuleRequest({
            rule: ruleProto,
            trunkIds: trunkIds,
            hidePhoneNumber: hidePhoneNumber,
        }).toJson();
        const data = await this.rpc.request(svc, 'CreateSIPDispatchRule', req, await this.authHeader({}));
        return SIPDispatchRuleInfo.fromJson(data, { ignoreUnknownFields: true });
    }
    async listSipDispatchRule() {
        var _a;
        let req = {};
        const data = await this.rpc.request(svc, 'ListSIPDispatchRule', new ListSIPDispatchRuleRequest(req).toJson(), await this.authHeader({}));
        return (_a = ListSIPDispatchRuleResponse.fromJson(data, { ignoreUnknownFields: true }).items) !== null && _a !== void 0 ? _a : [];
    }
    /**
     * @param sipDispatchRuleId sip trunk to delete
     */
    async deleteSipDispatchRule(sipDispatchRuleId) {
        const data = await this.rpc.request(svc, 'DeleteSIPDispatchRule', new DeleteSIPDispatchRuleRequest({ sipDispatchRuleId }).toJson(), await this.authHeader({}));
        return SIPDispatchRuleInfo.fromJson(data, { ignoreUnknownFields: true });
    }
    /**
     * @param sipTrunkId sip trunk to use for the call
     * @param number number to dial
     * @param roomName room to attach the call to
     * @param opts CreateSipParticipantOptions
     */
    async createSipParticipant(sipTrunkId, number, roomName, opts) {
        let participantIdentity = '';
        let participantName = '';
        let dtmf = '';
        let playRingtone = false;
        if (opts !== undefined) {
            participantIdentity = opts.participantIdentity || '';
            participantName = opts.participantName || '';
            dtmf = opts.dtmf || '';
            playRingtone = opts.playRingtone || false;
        }
        const req = new CreateSIPParticipantRequest({
            sipTrunkId: sipTrunkId,
            sipCallTo: number,
            roomName: roomName,
            participantIdentity: participantIdentity,
            participantName: participantName,
            dtmf: dtmf,
            playRingtone: playRingtone,
        }).toJson();
        const data = await this.rpc.request(svc, 'CreateSIPParticipant', req, await this.authHeader({}));
        return SIPParticipantInfo.fromJson(data, { ignoreUnknownFields: true });
    }
}
//# sourceMappingURL=SipClient.js.map